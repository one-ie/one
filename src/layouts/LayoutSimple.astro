---
import Header from '../components/Header';
import Footer from '../components/Footer';
import Right from '../components/Right';

interface Props {
  header?: boolean;
  footer?: boolean;
  right?: boolean;
  rightSize?: 'full' | 'half' | 'quarter' | 'icon';
  title?: string;
}

const {
  header = true,
  footer = true,
  right = true,
  rightSize: initialRightSize = 'quarter',
  title = 'Layout'
} = Astro.props;
---

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{title}</title>
  <style>
    :root {
      --right-panel-width: var(--right-width-full);
      --right-width-full: 100vw;
      --right-width-half: 50%;
      --right-width-quarter: 25%;
      --right-width-icon: 48px;
      --header-height: 60px;
    }
  
    .main-grid {
      display: grid;
      grid-template-columns: 1fr;
      min-height: 100vh;
      position: relative;
      z-index: 10;
    }
  
    .right-sidebar {
      position: fixed;
      right: 0;
      top: 0;
      height: 100vh;
      width: var(--right-panel-width);
      transition: width 0.2s ease;
    }
  
    .center-grid {
      transition: margin-right 0.2s ease, width 0.2s ease;
      position: relative;
      z-index: 10;
    }
  
    /* Add new class for when right panel is not in icon mode */
    .center-grid:not(.icon-mode) {
      margin-right: var(--right-panel-width);
      width: calc(100% - var(--right-panel-width));
    }
  
    /* When in icon mode, expand to full width */
    .center-grid.icon-mode {
      margin-right: 0;
      width: 100%;
    }
  
    @media (max-width: 768px) {
      .right-sidebar {
        transform: translateX(100%);
        width: 100% !important;
        z-index: 50;
      }
  
      .right-sidebar.sidebar-active {
        transform: translateX(0);
      }
  
      .center-grid {
        margin-right: 0;
        width: 100%;
      }
    }
  
    /* Add smooth scrolling to the whole page */
    html {
      scroll-behavior: smooth;
    }
  
    /* Improve the scrollbar appearance */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
  
    ::-webkit-scrollbar-track {
      background: transparent;
    }
  
    ::-webkit-scrollbar-thumb {
      background: #d1d5db;
      border-radius: 4px;
    }
  
    ::-webkit-scrollbar-thumb:hover {
      background: #9ca3af;
    }
  </style>
  
  <body>
    <div class="main-grid">
      <div class={`center-grid ${initialRightSize === 'icon' ? 'icon-mode' : ''}`} id="center-grid">
        {header && <Header client:only="react" showLeft={true} showRight={right} />}
        
        <main class="p-4">
          <slot />
        </main>
  
        {footer && <Footer client:only="react" />}
      </div>
    </div>
  
    {right && <Right client:only="react" initialSize={initialRightSize} />}
  
    <script>
      // Add client-side listener to update icon-mode class
      document.addEventListener('DOMContentLoaded', () => {
        const centerGrid = document.getElementById('center-grid');
        const observer = new MutationObserver((mutations) => {
          mutations.forEach((mutation) => {
            if (mutation.type === 'attributes' && mutation.attributeName === 'style') {
              const rightPanelWidth = getComputedStyle(document.documentElement)
                .getPropertyValue('--right-panel-width')
                .trim();
              centerGrid?.classList.toggle('icon-mode', rightPanelWidth === '3rem' || rightPanelWidth === '48px');
            }
          });
        });
  
        observer.observe(document.documentElement, {
          attributes: true,
          attributeFilter: ['style']
        });
      });
    </script>
  </body>
</html>