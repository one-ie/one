---
import Layout from "../../layouts/Layout.astro";
import { getCollection } from "astro:content";
import { Book, ScrollText, ArrowRight } from "lucide-react";
import type { CollectionEntry } from "astro:content";

// Get all Docs entries sorted by order and section
const entries = (await getCollection("docs"))
  .sort((a: CollectionEntry<"docs">, b: CollectionEntry<"docs">) => {
    // First sort by section
    if (a.data.section !== b.data.section) {
      return (a.data.section || "").localeCompare(b.data.section || "");
    }
    // Then by order if available
    if (a.data.order !== undefined && b.data.order !== undefined) {
      return a.data.order - b.data.order;
    }
    // Finally by date
    return new Date(b.data.date).getTime() - new Date(a.data.date).getTime();
  });

// Group entries by section
type DocsSection = Record<string, CollectionEntry<"docs">[]>;
const sections: DocsSection = entries.reduce((acc: DocsSection, entry: CollectionEntry<"docs">) => {
  const section = entry.data.section || "General";
  if (!acc[section]) {
    acc[section] = [];
  }
  acc[section].push(entry);
  return acc;
}, {} as DocsSection);
---

<Layout
  title="Documentation - Guides and References"
  description="Explore our comprehensive documentation, guides, and references"
>
  <div class="max-w-[90rem] mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Hero Section -->
    <div class="py-12 md:py-20 text-center">
      <h1 class="text-4xl md:text-6xl font-extrabold bg-clip-text text-transparent bg-gradient-to-r from-primary via-primary/80 to-primary/60 mb-4 tracking-tight">
        Documentation
      </h1>
      <p class="text-xl text-muted-foreground max-w-2xl mx-auto">
        Everything you need to know about using our platform
      </p>
    </div>

    <!-- Documentation Sections -->
    <div class="space-y-16 max-w-[85rem] mx-auto">
      {Object.entries(sections).map(([sectionName, sectionEntries]) => (
        <section>
          <h2 class="text-2xl font-bold mb-8 flex items-center gap-2">
            <Book className="w-6 h-6 text-primary" />
            {sectionName}
          </h2>
          <div class="grid gap-8 md:grid-cols-2 lg:grid-cols-3">
            {sectionEntries.map((entry: CollectionEntry<"docs">) => (
              <div class="group hover:bg-muted/50 rounded-lg border border-muted/40 shadow-sm transition-all duration-200 hover:shadow-md">
                <a
                  href={`/docs/${entry.slug}`}
                  class="block p-6 h-full"
                >
                  <div class="flex items-start gap-4">
                    <div class="p-2.5 rounded-lg bg-primary/10 text-primary">
                      <ScrollText className="w-5 h-5" />
                    </div>
                    <div class="flex-1 min-w-0">
                      <h3 class="text-lg font-semibold mb-2 group-hover:text-primary transition-colors truncate">
                        {entry.data.title}
                      </h3>
                      <p class="text-muted-foreground text-sm mb-4 line-clamp-2">
                        {entry.data.description}
                      </p>
                      <div class="inline-flex items-center text-sm font-medium text-primary opacity-0 group-hover:opacity-100 transition-opacity">
                        Read More
                        <ArrowRight className="w-4 h-4 ml-1" />
                      </div>
                    </div>
                  </div>
                </a>
              </div>
            ))}
          </div>
        </section>
      ))}
    </div>
  </div>
</Layout>