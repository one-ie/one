---
import Layout from "../layouts/Layout.astro";
import { Button } from "@/components/ui/button";
import { Alert, AlertDescription } from "@/components/ui/alert";
import { Card } from "@/components/ui/card";
import { ChatConfigSchema } from '../schema/chat';
import {
  GitHubLogoIcon,
  CodeIcon,
  DownloadIcon,
  CheckIcon,
} from '@radix-ui/react-icons';

// Import license content
import License from '../../LICENSE?raw';
import FaqAccordion from "../components/FaqAccordion";

const SYSTEM_REQUIREMENTS = [
  "Node.js 18.x or higher",
  "pnpm package manager",
  "Modern web browser (Chrome, Firefox, Safari, Edge)",
  "Any modern operating system (Windows, macOS, Linux)",
  "Deploy on Vercel, Netlify, AWS or any Node.js server",
];

const INSTALLATION_STEPS = [
  {
    title: "Setup Framework",
    description: "Download and install using Git or ZIP, then run 'pnpm install'",
  },
  {
    title: "Configure AI Models",
    description: "Set up AI providers and customize agent behaviors",
  },
  {
    title: "Payment Integration",
    description: "Configure crypto wallets and payment processors",
  },
  {
    title: "Token Setup",
    description: "Connect wallet and verify token holdings for features",
  },
  {
    title: "Deploy Agents",
    description: "Launch your first AI agent and test transactions",
  }
];

const TOKEN_TIERS = [
  {
    tokens: "100 ONE",
    features: "Single project white-label rights",
    includes: ["Remove branding", "Custom domain", "Basic support"]
  },
  {
    tokens: "1,000 ONE",
    features: "Multi-domain deployment",
    includes: ["Multiple projects", "Premium support", "Custom agents"]
  },
  {
    tokens: "10,000 ONE",
    features: "Unlimited commercial use",
    includes: ["Unlimited projects", "Priority support", "Advanced features"]
  },
  {
    tokens: "50,000+ ONE",
    features: "Enterprise package",
    includes: ["Strategy consulting", "Custom training", "Dedicated support"]
  }
];

const GITHUB_REPO = "one-ie/one";
const GITHUB_URL = `https://github.com/${GITHUB_REPO}`;
const DOWNLOAD_URL = `https://github.com/${GITHUB_REPO}/archive/refs/heads/main.zip`;

const URLS = {
  clone: `git clone https://github.com/${GITHUB_REPO}.git`,
  codespace: `https://github.com/codespaces/new?hide_repo_select=true&ref=main&repo=${GITHUB_REPO}`,
  fork: `https://github.com/${GITHUB_REPO}/fork`,
};

// Configure chat
const chatConfig = ChatConfigSchema.parse({
  systemPrompt: [{
    type: "text" as const,
    text: `You are ONE's setup specialist, helping users build AI-powered businesses. Your role includes:
    
    - Guiding users through framework installation
    - Setting up AI agents for sales and support
    - Configuring crypto and traditional payments
    - Explaining the token-based features
    - Implementing content automation
    - Troubleshooting technical issues
    
    Key Features to Highlight:
    1. AI Agent Capabilities
       ‚Ä¢ 24/7 automated sales and support
       ‚Ä¢ Content generation and optimization
       ‚Ä¢ Multi-language support
       ‚Ä¢ Custom training options
    
    2. Payment Integration
       ‚Ä¢ Crypto: BTC, ETH, SOL
       ‚Ä¢ Traditional: Cards, transfers
       ‚Ä¢ Digital: Apple Pay, Google Pay
       ‚Ä¢ Global: Alipay, Klarna
    
    3. Token System Benefits
       ‚Ä¢ 100 ONE - Single project
       ‚Ä¢ 1,000 ONE - Multiple domains
       ‚Ä¢ 10,000 ONE - Unlimited projects
       ‚Ä¢ 50,000+ ONE - Enterprise features
    
    Reference Information:
    ${JSON.stringify({ SYSTEM_REQUIREMENTS, INSTALLATION_STEPS, URLS }, null, 2)}
    
    Focus on helping users deploy their first AI agent and set up payment processing. Guide them through token system benefits.`
  }],
  welcome: {
    message: "üëã Ready to build your AI-powered business? I'll help you get started with AI agents, payments, and token features.",
    avatar: "/icon.svg",
    suggestions: [
      {
        label: "ü§ñ AI Agent Setup",
        prompt: "How do I create my first AI sales agent?"
      },
      {
        label: "üí≥ Payment Integration",
        prompt: "Guide me through setting up crypto and traditional payments"
      },
      {
        label: "ü™ô Token Features",
        prompt: "Explain how the token system works for unlocking features"
      },
      {
        label: "üì• Quick Install",
        prompt: "What's the fastest way to get started with ONE?"
      }
    ]
  }
});

// Fetch GitHub stars count
const getGitHubStats = async () => {
  try {
    const response = await fetch(`https://api.github.com/repos/${GITHUB_REPO}`);
    const data = await response.json();
    return {
      stars: data.stargazers_count,
      forks: data.forks_count
    };
  } catch (error) {
    console.error('Error fetching GitHub stats:', error);
    return { stars: '14.2k', forks: '3.1k' }; // Fallback values
  }
};

const stats = await getGitHubStats();

const faqs = [
  {
    question: "How do I access white-label features?",
    answer: "White-label features are accessed through our token system:\n‚Ä¢ 100 ONE - Full white-label for single project\n‚Ä¢ 1,000 ONE - Multiple domains\n‚Ä¢ 10,000 ONE - Unlimited projects\n‚Ä¢ 50,000+ ONE - Enterprise with training\n\nJust hold the required tokens in your wallet to unlock features."
  },
  {
    question: "What payment methods can I integrate?",
    answer: "ONE supports comprehensive payment options:\n‚Ä¢ Cryptocurrencies: BTC, ETH, SOL\n‚Ä¢ Traditional: Credit cards, bank transfers\n‚Ä¢ Digital wallets: Apple Pay, Google Pay\n‚Ä¢ Global options: Alipay, Klarna\n\nAll payment methods include real-time verification and automated processing."
  },
  {
    question: "How do I create AI agents?",
    answer: "Creating AI agents is simple:\n1. Choose agent type (sales, support, content)\n2. Configure AI model and behaviors\n3. Train on your data and content\n4. Set up payment processing if needed\n5. Deploy to your website\n\nFull documentation available at https://one.ie/docs/ai-agents"
  },
  {
    question: "What can AI agents do?",
    answer: "ONE's AI agents can:\n‚Ä¢ Handle complete sales processes\n‚Ä¢ Generate and optimize content\n‚Ä¢ Process payments and orders\n‚Ä¢ Provide 24/7 customer support\n‚Ä¢ Create marketing materials\n‚Ä¢ Manage social media\n‚Ä¢ Operate in multiple languages"
  },
  {
    question: "Can I modify the source code?",
    answer: "Yes! You own any modifications you make. You can customize:\n‚Ä¢ AI agent behaviors\n‚Ä¢ Payment flows\n‚Ä¢ UI/UX design\n‚Ä¢ Business logic\n‚Ä¢ Integration points\n‚Ä¢ Training data\n\nAll while maintaining compatibility with our token system."
  },
  {
    question: "What about enterprise needs?",
    answer: "For enterprise users holding 50,000+ ONE tokens, we provide:\n‚Ä¢ Priority support\n‚Ä¢ Custom AI training\n‚Ä¢ Advanced features\n‚Ä¢ Strategy consulting\n‚Ä¢ Team training\n‚Ä¢ Custom integrations\n‚Ä¢ Dedicated account manager"
  }
];
---

<Layout
  title="Download ONE - AI Agents & Crypto Commerce Framework"
  description="Download the first framework for building intelligent AI agents that generate content, engage customers, and process crypto payments. Free and open source."
  chatConfig={chatConfig}
  rightPanelMode="quarter"
>
  <main class="container mx-auto px-6 w-full">
    

      <!-- Download Options Grid -->
      <div class="grid md:grid-cols-2 gap-8 w-full max-w-4xl mb-12">
        <!-- Direct Download Card -->
        <Card className="p-6 flex flex-col items-center hover:shadow-lg transition-shadow">
          <h3 class="text-2xl font-bold mb-4">Quick Download</h3>
          <p class="text-muted-foreground mb-6">Download the latest stable release directly</p>
          <a href={DOWNLOAD_URL} class="w-full">
            <Button size="lg" className="w-full">
              <DownloadIcon className="mr-2 h-5 w-5" />
              Download ZIP
            </Button>
          </a>
        </Card>

        <!-- Git Clone Card -->
        <Card className="p-6 flex flex-col items-center hover:shadow-lg transition-shadow">
          <h3 class="text-2xl font-bold mb-4">Git Integration</h3>
          <p class="text-muted-foreground mb-6">Clone the repository using Git</p>
          <Button 
            variant="outline" 
            size="lg" 
            className="w-full group bg-background border-2 hover:border-primary hover:bg-primary/5 transition-all duration-300 text-foreground hover:text-foreground"
            id="copyCloneCommand"
          >
            <CodeIcon className="w-5 h-5 mr-2 text-primary" />
            <code class="font-mono text-sm">git clone {GITHUB_REPO}</code>
          </Button>
          <p id="copyMessage" class="mt-2 text-sm text-primary opacity-0 transition-opacity duration-200">
            Copied to clipboard!
          </p>
        </Card>
      </div>

      <!-- Secondary Options -->
      <div class="flex flex-wrap gap-4 justify-center mb-12">
        <a href={URLS.codespace} class="inline-block">
          <Button 
            variant="outline" 
            size="lg" 
            className="group bg-[#0D1117] hover:bg-[#161B22] border-2 border-[#30363D] hover:border-primary text-white hover:text-white transition-all duration-300"
          >
            <GitHubLogoIcon className="w-5 h-5 mr-2" />
            <span>Open in Codespaces</span>
          </Button>
        </a>
        
        <a href={GITHUB_URL} class="inline-block">
          <Button 
            variant="outline" 
            size="lg" 
            className="group text-foreground hover:text-foreground"
          >
            <GitHubLogoIcon className="w-5 h-5 mr-2" />
            <span>View Source</span>
            <div class="ml-2 px-2 py-0.5 bg-muted rounded-full text-xs font-medium">
              {stats.stars} ‚≠ê
            </div>
          </Button>
        </a>

        <a href={URLS.fork} class="inline-block">
          <Button 
            variant="outline" 
            size="lg" 
            className="group text-foreground hover:text-foreground"
          >
            <svg class="w-5 h-5 mr-2" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M7 5C7 3.89543 7.89543 3 9 3C10.1046 3 11 3.89543 11 5C11 5.74028 10.5978 6.38663 10 6.73244V14.0396H14.7761C15.1132 13.4132 15.7859 13 16.5 13C17.6046 13 18.5 13.8954 18.5 15C18.5 16.1046 17.6046 17 16.5 17C15.7859 17 15.1132 16.5868 14.7761 15.9604H10V17.2676C10.5978 17.6134 11 18.2597 11 19C11 20.1046 10.1046 21 9 21C7.89543 21 7 20.1046 7 19C7 18.2597 7.40221 17.6134 8 17.2676V6.73244C7.40221 6.38663 7 5.74028 7 5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span>Fork Project</span>
            <div class="ml-2 px-2 py-0.5 bg-muted rounded-full text-xs font-medium">
              {stats.forks}
            </div>
          </Button>
        </a>
      </div>
    </section>

    <!-- System Requirements & Installation -->
    <section class="w-full max-w-[1400px] mb-20 grid md:grid-cols-2 gap-8">
      <Card className="p-8">
        <h2 class="text-2xl font-bold mb-6">System Requirements</h2>
        <ul class="space-y-4">
          {SYSTEM_REQUIREMENTS.map(req => (
            <li class="flex items-start">
              <CheckIcon className="w-5 h-5 mr-2 text-green-500 flex-shrink-0 mt-1" />
              <span>{req}</span>
            </li>
          ))}
        </ul>
      </Card>

      <Card className="p-8">
        <h2 class="text-2xl font-bold mb-6">Installation Guide</h2>
        <div class="space-y-6">
          {INSTALLATION_STEPS.map((step, index) => (
            <div class="flex items-start">
              <div class="w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center mr-4 flex-shrink-0">
                <span class="font-bold text-primary">{index + 1}</span>
              </div>
              <div>
                <h3 class="font-semibold mb-1">{step.title}</h3>
                <p class="text-muted-foreground text-sm">{step.description}</p>
              </div>
            </div>
          ))}
        </div>
      </Card>
    </section>

    <!-- Token Tiers -->
    <section class="w-full max-w-[1400px] mb-20">
      <h2 class="text-4xl font-bold mb-10 text-center">Token-Based Features</h2>
      <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
        {TOKEN_TIERS.map(tier => (
          <Card className="p-6 hover:shadow-lg transition-shadow">
            <div class="flex flex-col h-full">
              <div class="mb-4">
                <h3 class="text-2xl font-bold text-primary mb-2">{tier.tokens}</h3>
                <p class="text-lg font-medium mb-4">{tier.features}</p>
              </div>
              <ul class="space-y-3 flex-grow">
                {tier.includes.map(feature => (
                  <li class="flex items-start gap-2">
                    <CheckIcon className="w-5 h-5 text-green-500 flex-shrink-0 mt-0.5" />
                    <span class="text-muted-foreground">{feature}</span>
                  </li>
                ))}
              </ul>
              <div class="mt-6 pt-4 border-t">
                <Button
                  variant="outline"
                  size="sm"
                  className="w-full hover:bg-primary/5"
                >
                  Get Tokens
                </Button>
              </div>
            </div>
          </Card>
        ))}
      </div>
    </section>

    <!-- License Section -->
    <section class="w-full max-w-[1400px] mb-20">
      <h2 class="text-4xl font-bold mb-10 text-center">Base License</h2>
      <Card className="prose prose-lg max-w-none dark:prose-invert p-8">
        <pre class="whitespace-pre-wrap text-sm leading-relaxed opacity-90">{License}</pre>
      </Card>
    </section>

    <section class="w-full max-w-[1400px] mb-20">
      <h2 class="text-4xl font-bold mb-10 text-center">Frequently Asked Questions</h2>
      <FaqAccordion client:idle faqs={faqs} />
    </section>

    <section class="text-center mb-16 w-full max-w-[1400px]">
      <Alert className="py-6">
        <AlertDescription className="text-lg">
          Join thousands of developers building the future with ONE.
          <a href={GITHUB_URL} class="inline-block">
            <Button variant="link" className="ml-3 text-lg text-foreground hover:text-foreground">
              Star on GitHub <GitHubLogoIcon className="ml-2 w-5 h-5" />
            </Button>
          </a>
        </AlertDescription>
      </Alert>
    </section>
  </main>
</Layout>

<style>
  .prose {
    @apply mx-auto;
  }
  
  .prose pre {
    @apply bg-muted;
  }

  .container {
    width: 95%;
    margin: 0 auto;
  }
  
  @media (max-width: 768px) {
    .container {
      width: 100%;
      padding-left: 1.5rem;
      padding-right: 1.5rem;
    }
  }
</style>

<script>
  // Handle copy functionality
  document.addEventListener('DOMContentLoaded', () => {
    const copyButton = document.getElementById('copyCloneCommand');
    const copyMessage = document.getElementById('copyMessage');
    
    if (copyButton && copyMessage) {
      copyButton.addEventListener('click', () => {
        navigator.clipboard.writeText('git clone one-ie/one');
        copyMessage.classList.remove('opacity-0');
        setTimeout(() => copyMessage.classList.add('opacity-0'), 2000);
      });
    }
  });
</script>
